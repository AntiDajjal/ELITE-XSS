// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ELITE PENTEST FRAMEWORK v6.0 - DYNAMIC MODULE LOADER
// File: Elite_Pentest_Framework_Loader.js
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// ==UserScript==
// @name         Elite Pentest Framework v6.0 - Module Loader
// @namespace    http://tampermonkey.net/
// @version      6.0.0
// @description  Advanced pentest automation with modular configuration loading
// @match        *://*/*
// @grant        GM_xmlhttpRequest
// @grant        GM_setValue
// @grant        GM_getValue
// @grant        GM_deleteValue
// @grant        GM_notification
// @grant        GM_addStyle
// @grant        GM_openInTab
// @grant        GM_getTab
// @grant        GM_saveTab
// @grant        GM_getTabs
// @grant        unsafeWindow
// @grant        GM_cookie
// @grant        GM_download
// @connect      raw.githubusercontent.com
// @connect      *
// @run-at       document-start
// ==/UserScript==

(function() {
    'use strict';

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // CONFIGURATION - UPDATE THIS PATH TO YOUR FOLDER
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    const FRAMEWORK_CONFIG = {
        // ğŸ”§ UPDATE THIS PATH TO YOUR ELITE FRAMEWORK FOLDER
        BASE_PATH: 'file:///C:/Users/Moiz/Elite_Pentest_Framework_v6/',
        
        // Module files to load
        MODULES: [
            'BeastTm_Enhanced_2025.js',           // Main framework
            'Elite_WAF_Bypass_Config.js',         // WAF bypass configurations
            'Elite_ML_Learning_Config.js'         // ML learning parameters
        ],
        
        // Configuration files
        CONFIG_FILES: [
            'framework_config.json',              // User settings
            'custom_payloads.json',               // Custom payload sets
            'target_profiles.json'                // Target-specific configurations
        ],
        
        // Auto-load settings
        AUTO_LOAD: true,
        LOAD_TIMEOUT: 10000,  // 10 seconds timeout
        RETRY_ATTEMPTS: 3
    };

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // DYNAMIC MODULE LOADER
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    const ModuleLoader = {
        loadedModules: new Set(),
        loadErrors: [],
        
        init: async () => {
            console.log('%cğŸš€ Elite Framework v6.0 - Starting Module Loader...', 
                'color: #00d9ff; font-weight: bold; font-size: 14px;');
            
            try {
                // Load main framework first
                await ModuleLoader.loadMainFramework();
                
                // Load configuration modules
                await ModuleLoader.loadConfigModules();
                
                // Load user configurations
                await ModuleLoader.loadUserConfigs();
                
                // Initialize framework
                await ModuleLoader.initializeFramework();
                
                console.log('%câœ… Elite Framework v6.0 - All modules loaded successfully!', 
                    'color: #00ff88; font-weight: bold;');
                    
            } catch (error) {
                console.error('%câŒ Elite Framework v6.0 - Loading failed:', 
                    'color: #ff3860; font-weight: bold;', error);
                ModuleLoader.showErrorDialog(error);
            }
        },
        
        loadMainFramework: async () => {
            const mainFile = FRAMEWORK_CONFIG.MODULES[0];
            console.log(`ğŸ“¦ Loading main framework: ${mainFile}`);
            
            try {
                const code = await ModuleLoader.loadFile(mainFile);
                
                // Execute main framework but prevent auto-initialization
                const modifiedCode = code.replace(
                    'setTimeout(TestOrchestrator.init, 100);',
                    '// Auto-init disabled - will be called by loader'
                );
                
                eval(modifiedCode);
                ModuleLoader.loadedModules.add(mainFile);
                
            } catch (error) {
                throw new Error(`Failed to load main framework: ${error.message}`);
            }
        },
        
        loadConfigModules: async () => {
            const configModules = FRAMEWORK_CONFIG.MODULES.slice(1);
            
            for (const module of configModules) {
                try {
                    console.log(`âš™ï¸ Loading config module: ${module}`);
                    const code = await ModuleLoader.loadFile(module);
                    eval(code);
                    ModuleLoader.loadedModules.add(module);
                } catch (error) {
                    console.warn(`âš ï¸ Config module ${module} failed to load:`, error.message);
                    ModuleLoader.loadErrors.push({ module, error: error.message });
                }
            }
        },
        
        loadUserConfigs: async () => {
            for (const configFile of FRAMEWORK_CONFIG.CONFIG_FILES) {
                try {
                    console.log(`ğŸ“‹ Loading config: ${configFile}`);
                    const configData = await ModuleLoader.loadFile(configFile);
                    const config = JSON.parse(configData);
                    
                    // Apply configurations
                    ModuleLoader.applyUserConfig(configFile, config);
                    
                } catch (error) {
                    console.warn(`âš ï¸ Config file ${configFile} not found or invalid:`, error.message);
                    // Create default config if it doesn't exist
                    ModuleLoader.createDefaultConfig(configFile);
                }
            }
        },
        
        loadFile: (filename) => {
            return new Promise((resolve, reject) => {
                const fullPath = FRAMEWORK_CONFIG.BASE_PATH + filename;
                
                GM_xmlhttpRequest({
                    method: 'GET',
                    url: fullPath,
                    timeout: FRAMEWORK_CONFIG.LOAD_TIMEOUT,
                    onload: (response) => {
                        if (response.status === 200) {
                            resolve(response.responseText);
                        } else {
                            reject(new Error(`HTTP ${response.status}: ${response.statusText}`));
                        }
                    },
                    onerror: () => reject(new Error('Network error loading file')),
                    ontimeout: () => reject(new Error('Timeout loading file'))
                });
            });
        },
        
        applyUserConfig: (filename, config) => {
            switch (filename) {
                case 'framework_config.json':
                    // Apply framework settings
                    if (window.CONFIG && config.framework) {
                        Object.assign(window.CONFIG, config.framework);
                    }
                    break;
                    
                case 'custom_payloads.json':
                    // Add custom payloads
                    if (window.PayloadManager && config.payloads) {
                        if (!window.PayloadManager.customPayloads) {
                            window.PayloadManager.customPayloads = [];
                        }
                        window.PayloadManager.customPayloads.push(...config.payloads);
                    }
                    break;
                    
                case 'target_profiles.json':
                    // Apply target-specific settings
                    if (config.profiles) {
                        const currentDomain = window.location.hostname;
                        const profile = config.profiles[currentDomain];
                        if (profile && window.CONFIG) {
                            Object.assign(window.CONFIG, profile);
                        }
                    }
                    break;
            }
        },
        
        createDefaultConfig: (filename) => {
            let defaultConfig = {};
            
            switch (filename) {
                case 'framework_config.json':
                    defaultConfig = {
                        framework: {
                            PARALLEL_TABS: 8,
                            TEST_DELAY: 800,
                            ENABLE_QUANTUM_BYPASS: true,
                            ENABLE_ML_PREDICTION: true,
                            LOG_LEVEL: 'INFO'
                        },
                        user_preferences: {
                            theme: 'quantum',
                            auto_export: true,
                            notification_level: 'important'
                        }
                    };
                    break;
                    
                case 'custom_payloads.json':
                    defaultConfig = {
                        payloads: [
                            '<script>console.log("custom-payload-1")</script>',
                            '<img src=x onerror=console.log("custom-payload-2")>',
                            'javascript:console.log("custom-payload-3")'
                        ],
                        categories: {
                            custom: ['basic', 'advanced', 'experimental']
                        }
                    };
                    break;
                    
                case 'target_profiles.json':
                    defaultConfig = {
                        profiles: {
                            'testphp.vulnweb.com': {
                                PARALLEL_TABS: 3,
                                TEST_DELAY: 1000,
                                ENABLE_WAF_BYPASS: false
                            },
                            'portswigger-labs.net': {
                                PARALLEL_TABS: 5,
                                TEST_DELAY: 500,
                                ENABLE_QUANTUM_BYPASS: true
                            },
                            'localhost': {
                                PARALLEL_TABS: 10,
                                TEST_DELAY: 200,
                                ENABLE_ALL_FEATURES: true
                            }
                        }
                    };
                    break;
            }
            
            // Save default config for user to customize
            const blob = new Blob([JSON.stringify(defaultConfig, null, 2)], 
                { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            console.log(`ğŸ“„ Creating default ${filename} - save to your framework folder`);
            GM_download(url, filename, url);
        },
        
        initializeFramework: async () => {
            // Wait for DOM to be ready
            if (document.readyState === 'loading') {
                await new Promise(resolve => {
                    document.addEventListener('DOMContentLoaded', resolve);
                });
            }
            
            // Initialize the main framework
            if (window.TestOrchestrator && window.TestOrchestrator.init) {
                await window.TestOrchestrator.init();
            }
            
            // Show load summary
            ModuleLoader.showLoadSummary();
        },
        
        showLoadSummary: () => {
            const summary = document.createElement('div');
            summary.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #1a1a2e, #16213e);
                border: 2px solid #00d9ff;
                border-radius: 15px;
                padding: 20px;
                z-index: 999999;
                color: #fff;
                font-family: monospace;
                text-align: center;
                box-shadow: 0 0 30px rgba(0, 217, 255, 0.5);
            `;
            
            summary.innerHTML = `
                <h3 style="color: #00d9ff; margin: 0 0 10px 0;">ğŸš€ Elite Framework v6.0 Loaded</h3>
                <p>âœ… Modules loaded: ${ModuleLoader.loadedModules.size}</p>
                <p>âš ï¸ Load errors: ${ModuleLoader.loadErrors.length}</p>
                <p style="font-size: 12px; color: #8e9aaf;">Dashboard will appear shortly...</p>
                <button id="close-summary" style="
                    background: linear-gradient(135deg, #00d9ff, #00ff88);
                    color: #000;
                    border: none;
                    padding: 8px 15px;
                    border-radius: 5px;
                    cursor: pointer;
                    font-weight: bold;
                    margin-top: 10px;
                ">OK</button>
            `;
            
            document.body.appendChild(summary);
            
            document.getElementById('close-summary').onclick = () => {
                summary.remove();
            };
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (summary.parentNode) {
                    summary.remove();
                }
            }, 5000);
        },
        
        showErrorDialog: (error) => {
            const errorDialog = document.createElement('div');
            errorDialog.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #2d1b69, #832161);
                border: 2px solid #ff3860;
                border-radius: 15px;
                padding: 20px;
                z-index: 999999;
                color: #fff;
                font-family: monospace;
                text-align: center;
                max-width: 500px;
                box-shadow: 0 0 30px rgba(255, 56, 96, 0.5);
            `;
            
            errorDialog.innerHTML = `
                <h3 style="color: #ff3860; margin: 0 0 10px 0;">âŒ Elite Framework Load Error</h3>
                <p style="font-size: 12px; margin-bottom: 15px;">${error.message}</p>
                <p style="font-size: 11px; color: #ffd700;">
                    ğŸ“ Check that files are in: <br>
                    <code>C:\\Users\\Moiz\\Elite_Pentest_Framework_v6\\</code>
                </p>
                <button id="close-error" style="
                    background: linear-gradient(135deg, #ff3860, #ff6b9d);
                    color: #fff;
                    border: none;
                    padding: 8px 15px;
                    border-radius: 5px;
                    cursor: pointer;
                    font-weight: bold;
                    margin-top: 10px;
                ">OK</button>
            `;
            
            document.body.appendChild(errorDialog);
            
            document.getElementById('close-error').onclick = () => {
                errorDialog.remove();
            };
        }
    };

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // AUTO-INITIALIZATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    if (FRAMEWORK_CONFIG.AUTO_LOAD) {
        // Start loading when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', ModuleLoader.init);
        } else {
            setTimeout(ModuleLoader.init, 100);
        }
    }

    // Expose for manual control
    window.EliteFrameworkLoader = ModuleLoader;

})();